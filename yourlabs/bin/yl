#!/usr/bin/env python
import sys
import os
import subprocess


def run(cmd):
    cmd = u' '.join(cmd)
    print '[yl] Running command: %s' % cmd
    output = subprocess.check_output(cmd, shell=True)
    print output.replace('django-admin.py startproject', 'yl')


def main():
    if sys.argv[1] == 'help':
        run(['django-admin.py', 'help', 'startproject'])
        sys.exit(0)

    cmd=['django-admin.py', 'startproject']
    cmd+=sys.argv[1:-1]
    cmd.append('--template=%s' % os.path.realpath(
        os.path.join(os.path.dirname(__file__), '..', 'project_template')))
    cmd.append(sys.argv[-1])

    run(cmd)

    project_path = os.path.join(os.getcwd(), sys.argv[-1])
    if os.path.exists(project_path):
        print '[yl] Project successfully created: %s' % project_path
        print '[yl] Installing requirements ...'
        subprocess.call(['pip', 'install', '-r', os.path.join(
            project_path, 'requirements', 'base.txt')])
    else:
        sys.exit(1)

if __name__ == "__main__":
    main()
